!function(e){"use strict";e.tokenizer={version:"0.1"},e.fn.tokenizer=e.fn.tk=function(){var t=this,n=13,r=46,a=8,o=function(e){for(var t=e.concat(),n=0;n<t.length;++n)for(var r=n+1;r<t.length;++r)t[n]===t[r]&&t.splice(r--,1);return t};String.__format||(String.__format=function(){for(var e=arguments[0],t=0;t<arguments.length-1;t++){var n=new RegExp("\\{"+t+"\\}","gm");e=e.replace(n,arguments[t+1])}return e});var i=function(t){var n=e("<div></div>").addClass("tokenizer-values").width(t.width()-8);return n},s=function(){e(".tokenizer-token").remove()},u=function(t){t.each(function(){e(this).remove()})},l=function(t){var n=e("<span></span>").addClass("tokenizer-token").text(t).attr("data-value",t).prepend(e("<span></span>").addClass("tokenizer-token-close").text("x"));return n.on("click",function(){e(this).toggleClass("tokenizer-token-active")}),n.find("span").on("click",function(){u(n)}),n},c=function(t){var n=l(e.fn.tokenizer.defaults.lang.max_all);n.addClass("tokenizer-token-max"),n.removeAttr("data-value"),t.append(n),setTimeout(function(){u(n)},1500)},f=function(){var t=[];return e(".tokenizer-token[data-value]").each(function(){t.push(e(this).attr("data-value"))}),t};if(!arguments.length||e.isPlainObject(arguments[0])){var g=arguments.length?arguments[0]:{};return e(document).on("keypress",function(t){(t.keyCode==r||t.keyCode==a)&&u(e(".tokenizer-token-active"))}),g=e.extend({},e.fn.tokenizer.defaults,g),t.each(function(){var t=e(this);console.log(t);var r=e("<div></div>").addClass("tokenizer-wrapper").width(t.width());t.wrap(r);var a=i(t);t.parent().append(a),t.off().on("keypress",function(r){if(r.keyCode==n){if(r.preventDefault(),""!=e.trim(t.val())){for(var i="s*[",u=0;u<g.characters.length;u++)i+=g.characters[u];i+="]s*";var d=new RegExp(i),v=t.val().split(d);g.max_input>0&&(v=v.splice(0,g.max_input));var v=f().concat(v),m=!1;if(g.max_all>0){var p=v.length;v=v.splice(0,g.max_all),p!=v.length&&(m=!0)}g.repeat||(v=o(v)),s(),e.each(v,function(t,n){n=e.trim(n),a.append(l(n))}),m&&c(a)}t.val("")}})})}switch(arguments[0]){case"get":case"val":if(arguments.length>1)throw new Error("Número de argumentos inválidos, se requiere ('option') solamente");return f();case"set":case"input":if(2!=arguments.length)throw new Error("Número de argumentos inválidos, se requiere ('option', String|Array)");if("string"==typeof arguments[1])t.val(arguments[1]),t.trigger(e.Event("keypress",{keyCode:n}));else{if(!(arguments[1]instanceof Array))throw new Error("Segundo parámetro inválido, se requiere ('option', String|Array)");var d=arguments[1].join(e.fn.tokenizer.defaults.characters[0]);t.val(d),t.trigger(e.Event("keypress",{keyCode:n}))}return t;case"del":case"delete":case"rm":case"remove":if(2!=arguments.length)throw new Error("Número de argumentos inválidos, se requiere ('option', String)");if("string"!=typeof arguments[1])throw new Error("Segundo parámetro inválido, se requiere ('option', String)");return e(".tokenizer-token[data-value='"+arguments[1]+"']").remove(),t;default:throw new Error(String.__format("Opción '{0}' no válida",arguments[0]))}},e.fn.tokenizer.defaults=e.fn.tk.defaults={characters:[",",";"],repeat:!1,max_all:0,max_input:0,lang:{max_all:"Máximo alcanzado"}}}(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS10b2tlbml6ZXItMC4xLmpzIl0sIm5hbWVzIjpbIiQiLCJ0b2tlbml6ZXIiLCJ2ZXJzaW9uIiwiZm4iLCJ0ayIsIiR0aGlzIiwidGhpcyIsIktFWV9DT0RFX0VOVEVSIiwiS0VZX0NPREVfU1VQUiIsIktFWV9DT0RFX0RFTCIsInVuaXF1ZUFycmF5IiwiYXJyYXkiLCJhIiwiY29uY2F0IiwiaSIsImxlbmd0aCIsImoiLCJzcGxpY2UiLCJTdHJpbmciLCJfX2Zvcm1hdCIsInMiLCJhcmd1bWVudHMiLCJyZWciLCJSZWdFeHAiLCJyZXBsYWNlIiwiZ2V0V3JhcHBlclZhbHVlcyIsIiRpbnB1dCIsIiR3cmFwcGVyVmFsdWVzIiwiYWRkQ2xhc3MiLCJ3aWR0aCIsInJlbW92ZUFsbFRva2VuIiwicmVtb3ZlIiwicmVtb3ZlVG9rZW4iLCIkdG9rZW5zIiwiZWFjaCIsImdldFRva2VuIiwidmFsdWUiLCIkdG9rZW4iLCJ0ZXh0IiwiYXR0ciIsInByZXBlbmQiLCJvbiIsInRvZ2dsZUNsYXNzIiwiZmluZCIsInNob3dNYXhBbGwiLCJkZWZhdWx0cyIsImxhbmciLCJtYXhfYWxsIiwicmVtb3ZlQXR0ciIsImFwcGVuZCIsInNldFRpbWVvdXQiLCJnZXRWYWx1ZXMiLCJ0b2tlbnMiLCJwdXNoIiwiaXNQbGFpbk9iamVjdCIsInNldHRpbmdzIiwiZG9jdW1lbnQiLCJlIiwia2V5Q29kZSIsImV4dGVuZCIsImNvbnNvbGUiLCJsb2ciLCIkd3JhcHBlciIsIndyYXAiLCJwYXJlbnQiLCJvZmYiLCJwcmV2ZW50RGVmYXVsdCIsInRyaW0iLCJ2YWwiLCJzdHJSZWciLCJjaGFyYWN0ZXJzIiwic3BsaXQiLCJtYXhfaW5wdXQiLCJzaG93TWF4IiwibGVuIiwicmVwZWF0IiwiayIsImVsIiwiRXJyb3IiLCJ0cmlnZ2VyIiwiRXZlbnQiLCJBcnJheSIsInN0ciIsImpvaW4iLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJDQVFDLFNBQVdBLEdBQ1IsWUFFQUEsR0FBRUMsV0FD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U0FBU3lCLFdBQVcsR0FDL0RqRSxHQUFNK0QsSUFBSWMsR0FDVjdFLEVBQU0wRSxRQUFRL0UsRUFBRWdGLE1BQU0sWUFBY3RCLFFBQVNuRCxLQUlqRCxNQUFPRixFQUNYLEtBQUssTUFDTCxJQUFLLFNBQ0wsSUFBSyxLQUNMLElBQUssU0FFRCxHQUF3QixHQUFwQmdCLFVBQVVOLE9BQ1YsS0FBTSxJQUFJK0QsT0FBTSxpRUFFcEIsSUFBNEIsZ0JBQWpCekQsV0FBVSxHQUdqQixLQUFNLElBQUl5RCxPQUFNLDZEQUVwQixPQUpJOUUsR0FBRSxnQ0FBa0NxQixVQUFVLEdBQUssTUFBTVUsU0FJdEQxQixDQUNYLFNBQ0ksS0FBTSxJQUFJeUUsT0FBTTVELE9BQU9DLFNBQVMseUJBQTBCRSxVQUFVLE9BTXBGckIsRUFBRUcsR0FBR0YsVUFBVTRDLFNBQVc3QyxFQUFFRyxHQUFHQyxHQUFHeUMsVUFDOUJ5QixZQUFhLElBQUssS0FDbEJLLFFBQVEsRUFDUjVCLFFBQVMsRUFDVHlCLFVBQVcsRUFDWDFCLE1BQ0lDLFFBQVMsc0JBSWxCcUMiLCJmaWxlIjoianF1ZXJ5LXRva2VuaXplci0wLjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogIGpxdWVyeS10b2tlbml6ZXIgLSB2MC4xXG4gKiAgQSBqUXVlcnkgdG9vbCB0byB0b2tlbml6ZXIgdmFsdWUgb24gaW5wdXRcbiAqICBodHRwczovL2dpdGh1Yi5jb20vbG1mcmVzbmVkYS9qcXVlcnktdG9rZW5pemVyXG4gKlxuICogIE1hZGUgYnkgTHVpcyBNaWd1ZWwgRi5cbiAqICBVbmRlciBNSVQgTGljZW5zZSAoaHR0cHM6Ly9naXRodWIuY29tL2xtZnJlc25lZGEvanF1ZXJ5LXRva2VuaXplci9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICovXG47KGZ1bmN0aW9uICgkKSB7IFxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgJC50b2tlbml6ZXIgPSB7XG4gICAgICAgIHZlcnNpb246IFwiMC4xXCJcbiAgICB9O1xuXG4gICAgJC5mbi50b2tlbml6ZXIgPSAkLmZuLnRrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgJHRoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgS0VZX0NPREVfRU5URVIgPSAxMyxcbiAgICAgICAgICAgIEtFWV9DT0RFX1NVUFIgPSA0NixcbiAgICAgICAgICAgIEtFWV9DT0RFX0RFTCA9IDg7XG4gICAgICAgIHZhciB1bmlxdWVBcnJheSA9IGZ1bmN0aW9uIChhcnJheSkge1xyXG4gICAgICAgICAgICB2YXIgYSA9IGFycmF5LmNvbmNhdCgpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGEubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSBpICsgMTsgaiA8IGEubGVuZ3RoOyArK2opIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYVtpXSA9PT0gYVtqXSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgYS5zcGxpY2Uoai0tLCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYTtcclxuICAgICAgICB9XG4gICAgICAgIGlmICghU3RyaW5nLl9fZm9ybWF0KSB7XHJcbiAgICAgICAgICAgIFN0cmluZy5fX2Zvcm1hdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzID0gYXJndW1lbnRzWzBdO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKFwiXFxcXHtcIiArIGkgKyBcIlxcXFx9XCIsIFwiZ21cIik7XG4gICAgICAgICAgICAgICAgICAgIHMgPSBzLnJlcGxhY2UocmVnLCBhcmd1bWVudHNbaSArIDFdKTtcclxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XG4gICAgICAgIHZhciBnZXRXcmFwcGVyVmFsdWVzID0gZnVuY3Rpb24gKCRpbnB1dCkge1xyXG4gICAgICAgICAgICB2YXIgJHdyYXBwZXJWYWx1ZXMgPSAkKFwiPGRpdj48L2Rpdj5cIilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoXCJ0b2tlbml6ZXItdmFsdWVzXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLndpZHRoKCRpbnB1dC53aWR0aCgpIC0gOCk7XG4gICAgICAgICAgICByZXR1cm4gJHdyYXBwZXJWYWx1ZXM7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJlbW92ZUFsbFRva2VuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKFwiLnRva2VuaXplci10b2tlblwiKS5yZW1vdmUoKTtcclxuICAgICAgICB9XG4gICAgICAgIHZhciByZW1vdmVUb2tlbiA9IGZ1bmN0aW9uKCR0b2tlbnMpIHtcclxuICAgICAgICAgICAgJHRva2Vucy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZ2V0VG9rZW4gPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdmFyICR0b2tlbiA9ICQoXCI8c3Bhbj48L3NwYW4+XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwidG9rZW5pemVyLXRva2VuXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQodmFsdWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJkYXRhLXZhbHVlXCIsIHZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5wcmVwZW5kKCQoXCI8c3Bhbj48L3NwYW4+XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKFwidG9rZW5pemVyLXRva2VuLWNsb3NlXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRleHQoXCJ4XCIpKTtcbiAgICAgICAgICAgICR0b2tlbi5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykudG9nZ2xlQ2xhc3MoXCJ0b2tlbml6ZXItdG9rZW4tYWN0aXZlXCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkdG9rZW4uZmluZChcInNwYW5cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVUb2tlbigkdG9rZW4pO1xyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAkdG9rZW47ICBcbiAgICAgICAgfVxuICAgICAgICB2YXIgc2hvd01heEFsbCA9IGZ1bmN0aW9uICgkd3JhcHBlclZhbHVlcykge1xyXG4gICAgICAgICAgICB2YXIgJHRva2VuID0gZ2V0VG9rZW4oJC5mbi50b2tlbml6ZXIuZGVmYXVsdHMubGFuZy5tYXhfYWxsKTtcbiAgICAgICAgICAgICR0b2tlbi5hZGRDbGFzcyhcInRva2VuaXplci10b2tlbi1tYXhcIik7XG4gICAgICAgICAgICAkdG9rZW4ucmVtb3ZlQXR0cihcImRhdGEtdmFsdWVcIik7XG4gICAgICAgICAgICAkd3JhcHBlclZhbHVlcy5hcHBlbmQoJHRva2VuKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVUb2tlbigkdG9rZW4pO1xuICAgICAgICAgICAgfSwgMTUwMClcbiAgICAgICAgfVxuICAgICAgICB2YXIgZ2V0VmFsdWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciB0b2tlbnMgPSBbXTtcbiAgICAgICAgICAgICQoXCIudG9rZW5pemVyLXRva2VuW2RhdGEtdmFsdWVdXCIpLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goJCh0aGlzKS5hdHRyKFwiZGF0YS12YWx1ZVwiKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiB0b2tlbnM7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGggfHwgJC5pc1BsYWluT2JqZWN0KGFyZ3VtZW50c1swXSkpIHtcclxuICAgICAgICAgICAgLy9iaW5kXHJcbiAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9ICFhcmd1bWVudHMubGVuZ3RoID8ge30gOiBhcmd1bWVudHNbMF07XHJcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKFwia2V5cHJlc3NcIiwgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gS0VZX0NPREVfU1VQUiB8fCBlLmtleUNvZGUgPT0gS0VZX0NPREVfREVMKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlVG9rZW4oJChcIi50b2tlbml6ZXItdG9rZW4tYWN0aXZlXCIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxuICAgICAgICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgJC5mbi50b2tlbml6ZXIuZGVmYXVsdHMsIHNldHRpbmdzKTtcbiAgICAgICAgICAgIFxuXG4gICAgICAgICAgICByZXR1cm4gJHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCRpbnB1dCk7XG4gICAgICAgICAgICAgICAgdmFyICR3cmFwcGVyID0gJChcIjxkaXY+PC9kaXY+XCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcInRva2VuaXplci13cmFwcGVyXCIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aWR0aCgkaW5wdXQud2lkdGgoKSk7XG4gICAgICAgICAgICAgICAgJGlucHV0LndyYXAoJHdyYXBwZXIpO1xuICAgICAgICAgICAgICAgIHZhciAkd3JhcHBlclZhbHVlcyA9IGdldFdyYXBwZXJWYWx1ZXMoJGlucHV0KTtcbiAgICAgICAgICAgICAgICAkaW5wdXQucGFyZW50KCkuYXBwZW5kKCR3cmFwcGVyVmFsdWVzKTtcbiAgICAgICAgICAgICAgICAkaW5wdXQub2ZmKCkub24oXCJrZXlwcmVzc1wiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT0gS0VZX0NPREVfRU5URVIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJC50cmltKCRpbnB1dC52YWwoKSkgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0clJlZyA9IFwiXFxzKltcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2V0dGluZ3MuY2hhcmFjdGVycy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0clJlZyArPSBzZXR0aW5ncy5jaGFyYWN0ZXJzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyUmVnICs9IFwiXVxccypcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKHN0clJlZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdG9rZW5zID0gJGlucHV0LnZhbCgpLnNwbGl0KHJlZyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb250cm9sYW1vcyBtYXhfaW5wdXRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5tYXhfaW5wdXQgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zLnNwbGljZSgwLCBzZXR0aW5ncy5tYXhfaW5wdXQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0b2tlbnMgPSBnZXRWYWx1ZXMoKS5jb25jYXQodG9rZW5zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzaG93TWF4ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnRyb2xhbW9zIG1heF9hbGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5tYXhfYWxsID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZW4gPSB0b2tlbnMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucyA9IHRva2Vucy5zcGxpY2UoMCwgc2V0dGluZ3MubWF4X2FsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlbiAhPSB0b2tlbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dNYXggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNldHRpbmdzLnJlcGVhdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VucyA9IHVuaXF1ZUFycmF5KHRva2Vucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlQWxsVG9rZW4oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCh0b2tlbnMsIGZ1bmN0aW9uIChrLCBlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsID0gJC50cmltKGVsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd3JhcHBlclZhbHVlcy5hcHBlbmQoZ2V0VG9rZW4oZWwpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dNYXgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd01heEFsbCgkd3JhcHBlclZhbHVlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0LnZhbChcIlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoKGFyZ3VtZW50c1swXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImdldFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcInZhbFwiOlxyXG4gICAgICAgICAgICAgICAgICAgIC8vZ2V0IHZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk7Dum1lcm8gZGUgYXJndW1lbnRvcyBpbnbDoWxpZG9zLCBzZSByZXF1aWVyZSAoJ29wdGlvbicpIHNvbGFtZW50ZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFZhbHVlcygpO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcInNldFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcImlucHV0XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zZXQgdmFsdWVcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk7Dum1lcm8gZGUgYXJndW1lbnRvcyBpbnbDoWxpZG9zLCBzZSByZXF1aWVyZSAoJ29wdGlvbicsIFN0cmluZ3xBcnJheSlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzFdID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vb25seSBpbnB1dFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy52YWwoYXJndW1lbnRzWzFdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMudHJpZ2dlcigkLkV2ZW50KFwia2V5cHJlc3NcIiwgeyBrZXlDb2RlOiBLRVlfQ09ERV9FTlRFUiB9KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHNbMV0gaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2FycmF5IGlucHV0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdHIgPSBhcmd1bWVudHNbMV0uam9pbigkLmZuLnRva2VuaXplci5kZWZhdWx0cy5jaGFyYWN0ZXJzWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMudmFsKHN0cik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnRyaWdnZXIoJC5FdmVudChcImtleXByZXNzXCIsIHsga2V5Q29kZTogS0VZX0NPREVfRU5URVIgfSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNlZ3VuZG8gcGFyw6FtZXRybyBpbnbDoWxpZG8sIHNlIHJlcXVpZXJlICgnb3B0aW9uJywgU3RyaW5nfEFycmF5KVwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICR0aGlzO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImRlbFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcImRlbGV0ZVwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcInJtXCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVtb3ZlXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgLy9yZW1vdmUgdmFsdWVcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk7Dum1lcm8gZGUgYXJndW1lbnRvcyBpbnbDoWxpZG9zLCBzZSByZXF1aWVyZSAoJ29wdGlvbicsIFN0cmluZylcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzFdID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIudG9rZW5pemVyLXRva2VuW2RhdGEtdmFsdWU9J1wiICsgYXJndW1lbnRzWzFdICsgXCInXVwiKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTZWd1bmRvIHBhcsOhbWV0cm8gaW52w6FsaWRvLCBzZSByZXF1aWVyZSAoJ29wdGlvbicsIFN0cmluZylcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkdGhpcztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFN0cmluZy5fX2Zvcm1hdChcIk9wY2nDs24gJ3swfScgbm8gdsOhbGlkYVwiLCBhcmd1bWVudHNbMF0pKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XG4gICAgfTtcblxuICAgICQuZm4udG9rZW5pemVyLmRlZmF1bHRzID0gJC5mbi50ay5kZWZhdWx0cyA9IHtcbiAgICAgICAgY2hhcmFjdGVyczogW1wiLFwiLCBcIjtcIl0sXG4gICAgICAgIHJlcGVhdDogZmFsc2UsXG4gICAgICAgIG1heF9hbGw6IDAsXG4gICAgICAgIG1heF9pbnB1dDogMCxcbiAgICAgICAgbGFuZzoge1xyXG4gICAgICAgICAgICBtYXhfYWxsOiBcIk3DoXhpbW8gYWxjYW56YWRvXCJcclxuICAgICAgICB9XG4gICAgfTtcblxufSkoalF1ZXJ5KTtcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9