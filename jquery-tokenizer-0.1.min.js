!function(e){"use strict";e.tokenizer={version:"0.1",KEY_CODE:{ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39,ARROW_TOP:38,BACKSPACE:32,COMMA:188,CTRL:17,DEL:8,DOT:190,ENTER:13,ESC:27,SHIFT:16,SUPR:46,TAB:9}},e.fn.tokenizer=function(){var n=this,t=function(e){for(var n=e.concat(),t=0;t<n.length;++t)for(var r=t+1;r<n.length;++r)n[t]===n[r]&&n.splice(r--,1);return n},r=function(n){var t=e("<div></div>").addClass("tokenizer-values").width(n.width()-7);return t},o=function(n){e(".tokenizer-token",n.parent()).remove()},a=function(n){n.each(function(){e(this).remove()})},i=function(n,t){var r=e("<span></span>").addClass("tokenizer-token").text(n).attr("data-value",n).prepend(e("<span></span>").addClass("tokenizer-token-close").text("x"));return r.on("click",t.onClickToken),r.find("span").on("click",function(){a(r)}),r},s=function(n,t){var r=i(e.fn.tokenizer.defaults.text.max_all,t);r.addClass("tokenizer-token-max"),r.removeAttr("data-value"),n.append(r),setTimeout(function(){a(r)},1500)},l=function(n){var t=[];return e(".tokenizer-token[data-value]",n.parent()).each(function(){t.push(e(this).attr("data-value"))}),t},u=function(e){for(var n="[",t=0;t<e.length;t++)n+=e[t];return n+="]",new RegExp(n)},c=function(n,t,r,a){o(n),e.each(t,function(n,t){if(t=e.trim(t),""!=t){var o=i(t,a);r.append(o)}})},d={get:function(e){if(e.length>1)throw new Error("Número de argumentos inválidos, se requiere ('option') solamente");return l(n)},set:function(t){var r;if(2!=t.length)throw new Error("Número de argumentos inválidos, se requiere ('option', String|Array)");if("string"==typeof t[1])r=t[1];else{if(!(t[1]instanceof Array))throw new Error("Segundo parámetro inválido, se requiere ('option', String|Array)");r=t[1].join(e.fn.tokenizer.defaults.separators[0])}return n.val(r),n.trigger(e.Event("keydown",{keyCode:e.tokenizer.KEY_CODE.ENTER})),n},del:function(t){if(2!=t.length)throw new Error("Número de argumentos inválidos, se requiere ('option', String)");if("string"!=typeof t[1])throw new Error("Segundo parámetro inválido, se requiere ('option', String)");return a(e(".tokenizer-token[data-value='"+t[1]+"']")),n}};if(!arguments.length||e.isPlainObject(arguments[0])){var f=arguments.length?arguments[0]:{};return e(document).on("keydown",function(n){n.keyCode==e.tokenizer.KEY_CODE.SUPR&&(a(e(".tokenizer-token-active")),f.onDeleteToken())}),f=e.extend({},e.fn.tokenizer.defaults,f),n.each(function(){var n=e(this);console.log(n);var o=e("<div></div>").addClass("tokenizer-wrapper").width(n.width());n.wrap(o);var a=r(n);n.parent().append(a),n.css("margin-bottom","0px"),n.off().on("keydown",function(r){if(r.keyCode==f.keyCodeCreate){if(r.preventDefault(),""!=e.trim(n.val())){var o=u(f.separators),i=n.val().split(o);f.max_input>0&&(i=i.splice(0,f.max_input));var i=l(n).concat(i),d=!1;if(f.max_all>0){var v=i.length;i=i.splice(0,f.max_all),v!=i.length&&(d=!0)}f.repeat||(i=t(i)),c(n,i,a,f),d&&s(a,f)}n.val("")}})})}switch(arguments[0]){case"get":case"val":return d.get(arguments);case"set":case"input":return d.set(arguments);case"del":case"delete":case"rm":case"remove":return d.del(arguments);default:throw new Error("Opción '"+arguments[0]+"' no válida")}},e.fn.tokenizer.defaults={separators:[",",";"],keyCodeCreate:e.tokenizer.KEY_CODE.ENTER,repeat:!1,max_all:0,max_input:0,text:{max_all:"Máximo alcanzado"},onClickToken:function(){e(this).toggleClass("tokenizer-token-active")},onDeleteToken:function(){}}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS10b2tlbml6ZXItMC4xLmpzIl0sIm5hbWVzIjpbIiQiLCJ0b2tlbml6ZXIiLCJ2ZXJzaW9uIiwiS0VZX0NPREUiLCJBUlJPV19ET1dOIiwiQVJST1dfTEVGVCIsIkFSUk9XX1JJR0hUIiwiQVJST1dfVE9QIiwiQkFDS1NQQUNFIiwiQ09NTUEiLCJDVFJMIiwiREVMIiwiRE9UIiwiRU5URVIiLCJFU0MiLCJTSElGVCIsIlNVUFIiLCJUQUIiLCJmbiIsIiR0aGlzIiwidGhpcyIsIl91bmlxdWVBcnJheSIsImFycmF5IiwiYSIsImNvbmNhdCIsImkiLCJsZW5ndGgiLCJqIiwic3BsaWNlIiwiX2dldFdyYXBwZXJWYWx1ZXMiLCIkaW5wdXQiLCIkd3JhcHBlclZhbHVlcyIsImFkZENsYXNzIiwid2lkdGgiLCJfcmVtb3ZlQWxsVG9rZW4iLCJwYXJlbnQiLCJyZW1vdmUiLCJfcmVtb3ZlVG9rZW4iLCIkdG9rZW5zIiwiZWFjaCIsIl9nZXRUb2tlbiIsInZhbHVlIiwic2V0dGluZ3MiLCIkdG9rZW4iLCJ0ZXh0IiwiYXR0ciIsInByZXBlbmQiLCJvbiIsIm9uQ2xpY2tUb2tlbiIsImZpbmQiLCJfc2hvd01heEFsbCIsImRlZmF1bHRzIiwibWF4X2FsbCIsInJlbW92ZUF0dHIiLCJhcHBlbmQiLCJzZXRUaW1lb3V0IiwiX2dldFZhbHVlcyIsInRva2VucyIsInB1c2giLCJfYnVpbGRSZWdFeHAiLCJzZXBhcmF0b3JzIiwic3RyUmVnIiwiUmVnRXhwIiwiX3ByaW50VG9rZW5zIiwiayIsImVsIiwidHJpbSIsIiR0ayIsIl9vcGVyYXRpb25zIiwiZ2V0IiwiYXJncyIsIkVycm9yIiwic2V0Iiwic3RyIiwiQXJyYXkiLCJqb2luIiwidmFsIiwidHJpZ2dlciIsIkV2ZW50Iiwia2V5Q29kZSIsImRlbCIsImFyZ3VtZW50cyIsImlzUGxhaW5PYmplY3QiLCJkb2N1bWVudCIsImUiLCJvbkRlbGV0ZVRva2VuIiwiZXh0ZW5kIiwiY29uc29sZSIsImxvZyIsIiR3cmFwcGVyIiwid3JhcCIsImNzcyIsIm9mZiIsImtleUNvZGVDcmVhdGUiLCJwcmV2ZW50RGVmYXVsdCIsInJlZyIsInNwbGl0IiwibWF4X2lucHV0Iiwic2hvd01heCIsImxlbiIsInJlcGVhdCIsInRvZ2dsZUNsYXNzIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FRQyxTQUFXQSxHQUNWLFlBRUFBLEdBQUVDLFdBQ0FDLFFBQVMsTUFDVEMsVUFDRUMsV0FBWSxHQUNaQyxXQUFZLEdBQ1pDLFlBQWEsR0FDYkMsVUFBVyxHQUNYQyxVQUFXLEdBQ1hDLE1BQU8sSUFDUEMsS0FBTSxHQUNOQyxJQUFLLEVBQ0xDLElBQUssSUFDTEMsTUFBTyxHQUNQQyxJQUFLLEdBQ0xDLE1BQU8sR0FDUEMsS0FBTSxHQUNOQyxJQUFLLElBSVRqQixFQUFFa0IsR0FBR2pCLFVBQVksV0FDZixHQUFJa0IsR0FBUUMsS0FHUkMsRUFBZSxTQUFVQyxHQUUzQixJQUFLLEdBRERDLEdBQUlELEVBQU1FLFNBQ0xDLEVBQUksRUFBR0EsRUFBSUYsRUFBRUcsU0FBVUQsRUFDOUIsSUFBSyxHQUFJRSxHQUFJRixFQUFJLEVBQUdFLEVBQUlKLEVBQUVHLFNBQVVDLEVBQzlCSixFQUFFRSxLQUFPRixFQUFFSSxJQUNiSixFQUFFSyxPQUFPRCxJQUFLLEVBR3BCLE9BQU9KLElBRUxNLEVBQW9CLFNBQVVDLEdBQ2hDLEdBQUlDLEdBQWlCL0IsRUFBRSxlQUN0QmdDLFNBQVMsb0JBQ1RDLE1BQU1ILEVBQU9HLFFBQVUsRUFDeEIsT0FBT0YsSUFFTEcsRUFBa0IsU0FBVUosR0FDOUI5QixFQUFFLG1CQUFvQjhCLEVBQU9LLFVBQVVDLFVBRXJDQyxFQUFlLFNBQVNDLEdBQzFCQSxFQUFRQyxLQUFLLFdBQ1h2QyxFQUFFb0IsTUFBTWdCLFlBR1JJLEVBQVksU0FBVUMsRUFBT0MsR0FDL0IsR0FBSUMsR0FBUzNDLEVBQUUsaUJBQ2RnQyxTQUFTLG1CQUNUWSxLQUFLSCxHQUNMSSxLQUFLLGFBQWNKLEdBQ25CSyxRQUFROUMsRUFBRSxpQkFDVmdDLFNBQVMseUJBQ1RZLEtBQUssS0FLTixPQUpBRCxHQUFPSSxHQUFHLFFBQVNMLEVBQVNNLGNBQzVCTCxFQUFPTSxLQUFLLFFBQVFGLEdBQUcsUUFBUyxXQUM5QlYsRUFBYU0sS0FFUkEsR0FFTE8sRUFBYyxTQUFVbkIsRUFBZ0JXLEdBQzFDLEdBQUlDLEdBQVNILEVBQVV4QyxFQUFFa0IsR0FBR2pCLFVBQVVrRCxTQUFTUCxLQUFLUSxRQUFTVixFQUM3REMsR0FBT1gsU0FBUyx1QkFDaEJXLEVBQU9VLFdBQVcsY0FDbEJ0QixFQUFldUIsT0FBT1gsR0FDdEJZLFdBQVcsV0FDVGxCLEVBQWFNLElBQ1osT0FFRGEsRUFBYSxTQUFTMUIsR0FDeEIsR0FBSTJCLEtBSUosT0FIQXpELEdBQUUsK0JBQWdDOEIsRUFBT0ssVUFBVUksS0FBSyxXQUN0RGtCLEVBQU9DLEtBQUsxRCxFQUFFb0IsTUFBTXlCLEtBQUssaUJBRXBCWSxHQUVMRSxFQUFlLFNBQVNDLEdBRTFCLElBQUssR0FEREMsR0FBUyxJQUNKcEMsRUFBSSxFQUFHQSxFQUFJbUMsRUFBV2xDLE9BQVFELElBQ3JDb0MsR0FBVUQsRUFBV25DLEVBR3ZCLE9BREFvQyxJQUFVLElBQ0gsR0FBSUMsUUFBT0QsSUFFaEJFLEVBQWUsU0FBVWpDLEVBQVEyQixFQUFRMUIsRUFBZ0JXLEdBQzNEUixFQUFnQkosR0FDaEI5QixFQUFFdUMsS0FBS2tCLEVBQVEsU0FBVU8sRUFBR0MsR0FFMUIsR0FEQUEsRUFBS2pFLEVBQUVrRSxLQUFLRCxHQUNGLElBQU5BLEVBQVUsQ0FDWixHQUFJRSxHQUFNM0IsRUFBVXlCLEVBQUl2QixFQUN4QlgsR0FBZXVCLE9BQU9hLE9BSXhCQyxHQUNGQyxJQUFLLFNBQVVDLEdBQ2IsR0FBSUEsRUFBSzVDLE9BQVMsRUFDaEIsS0FBTSxJQUFJNkMsT0FBTSxtRUFFbEIsT0FBT2YsR0FBV3JDLElBRXBCcUQsSUFBSyxTQUFVRixHQUNiLEdBQUlHLEVBQ0osSUFBbUIsR0FBZkgsRUFBSzVDLE9BQ1AsS0FBTSxJQUFJNkMsT0FBTSx1RUFFbEIsSUFBdUIsZ0JBQVpELEdBQUssR0FFZEcsRUFBTUgsRUFBSyxPQUNOLENBQUEsS0FBSUEsRUFBSyxZQUFjSSxRQUk1QixLQUFNLElBQUlILE9BQU0sbUVBRmhCRSxHQUFNSCxFQUFLLEdBQUdLLEtBQUszRSxFQUFFa0IsR0FBR2pCLFVBQVVrRCxTQUFTUyxXQUFXLElBTXhELE1BRkF6QyxHQUFNeUQsSUFBSUgsR0FDVnRELEVBQU0wRCxRQUFRN0UsRUFBRThFLE1BQU0sV0FBYUMsUUFBUy9FLEVBQUVDLFVBQVVFLFNBQVNVLFNBQzFETSxHQUVUNkQsSUFBSyxTQUFVVixHQUNiLEdBQW1CLEdBQWZBLEVBQUs1QyxPQUNQLEtBQU0sSUFBSTZDLE9BQU0saUVBRWxCLElBQXVCLGdCQUFaRCxHQUFLLEdBR2QsS0FBTSxJQUFJQyxPQUFNLDZEQUVsQixPQUpFbEMsR0FBYXJDLEVBQUUsZ0NBQWtDc0UsRUFBSyxHQUFLLE9BSXREbkQsR0FJWCxLQUFLOEQsVUFBVXZELFFBQVUxQixFQUFFa0YsY0FBY0QsVUFBVSxJQUFLLENBRXRELEdBQUl2QyxHQUFZdUMsVUFBVXZELE9BQWN1RCxVQUFVLEtBVWxELE9BVEFqRixHQUFFbUYsVUFBVXBDLEdBQUcsVUFBVyxTQUFVcUMsR0FDOUJBLEVBQUVMLFNBQVcvRSxFQUFFQyxVQUFVRSxTQUFTYSxPQUNwQ3FCLEVBQWFyQyxFQUFFLDRCQUNmMEMsRUFBUzJDLG1CQUliM0MsRUFBVzFDLEVBQUVzRixVQUFXdEYsRUFBRWtCLEdBQUdqQixVQUFVa0QsU0FBVVQsR0FFMUN2QixFQUFNb0IsS0FBSyxXQUNoQixHQUFJVCxHQUFTOUIsRUFBRW9CLEtBQ2ZtRSxTQUFRQyxJQUFJMUQsRUFDWixJQUFJMkQsR0FBV3pGLEVBQUUsZUFDaEJnQyxTQUFTLHFCQUNUQyxNQUFNSCxFQUFPRyxRQUNkSCxHQUFPNEQsS0FBS0QsRUFDWixJQUFJMUQsR0FBaUJGLEVBQWtCQyxFQUN2Q0EsR0FBT0ssU0FBU21CLE9BQU92QixHQUN2QkQsRUFBTzZELElBQUksZ0JBQWlCLE9BRTVCN0QsRUFBTzhELE1BQU03QyxHQUFHLFVBQVcsU0FBVXFDLEdBQ25DLEdBQUlBLEVBQUVMLFNBQVdyQyxFQUFTbUQsY0FBZSxDQUV2QyxHQURBVCxFQUFFVSxpQkFDMEIsSUFBeEI5RixFQUFFa0UsS0FBS3BDLEVBQU84QyxPQUFjLENBQzlCLEdBQUltQixHQUFNcEMsRUFBYWpCLEVBQVNrQixZQUM1QkgsRUFBUzNCLEVBQU84QyxNQUFNb0IsTUFBTUQsRUFHNUJyRCxHQUFTdUQsVUFBWSxJQUN2QnhDLEVBQVNBLEVBQU83QixPQUFPLEVBQUdjLEVBQVN1RCxXQUdyQyxJQUFJeEMsR0FBU0QsRUFBVzFCLEdBQVFOLE9BQU9pQyxHQUNuQ3lDLEdBQVUsQ0FFZCxJQUFJeEQsRUFBU1UsUUFBVSxFQUFHLENBQ3hCLEdBQUkrQyxHQUFNMUMsRUFBTy9CLE1BQ2pCK0IsR0FBU0EsRUFBTzdCLE9BQU8sRUFBR2MsRUFBU1UsU0FDL0IrQyxHQUFPMUMsRUFBTy9CLFNBQ2hCd0UsR0FBVSxHQUlUeEQsRUFBUzBELFNBQ1ozQyxFQUFTcEMsRUFBYW9DLElBR3hCTSxFQUFhakMsRUFBUTJCLEVBQVExQixFQUFnQlcsR0FFekN3RCxHQUNGaEQsRUFBWW5CLEVBQWdCVyxHQUVoQ1osRUFBTzhDLElBQUksU0FNakIsT0FBT0ssVUFBVSxJQUNmLElBQUssTUFDTCxJQUFLLE1BRUgsTUFBT2IsR0FBWUMsSUFBSVksVUFDekIsS0FBSyxNQUNMLElBQUssUUFFSCxNQUFPYixHQUFZSSxJQUFJUyxVQUN6QixLQUFLLE1BQ0wsSUFBSyxTQUNMLElBQUssS0FDTCxJQUFLLFNBRUgsTUFBT2IsR0FBWVksSUFBSUMsVUFDekIsU0FDRSxLQUFNLElBQUlWLE9BQU0sV0FBWVUsVUFBVSxHQUFJLGlCQU1sRGpGLEVBQUVrQixHQUFHakIsVUFBVWtELFVBQ2JTLFlBQWEsSUFBSyxLQUNsQmlDLGNBQWU3RixFQUFFQyxVQUFVRSxTQUFTVSxNQUNwQ3VGLFFBQVEsRUFDUmhELFFBQVMsRUFDVDZDLFVBQVcsRUFDWHJELE1BQ0VRLFFBQVMsb0JBRVhKLGFBQWMsV0FDWmhELEVBQUVvQixNQUFNaUYsWUFBWSwyQkFFdEJoQixjQUFlLGVBR2hCaUIiLCJmaWxlIjoianF1ZXJ5LXRva2VuaXplci0wLjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxyXG4gKiAganF1ZXJ5LXRva2VuaXplciAtIHYwLjFcclxuICogIEEgalF1ZXJ5IHRvb2wgdG8gdG9rZW5pemVyIHZhbHVlIG9uIGlucHV0XHJcbiAqICBodHRwczovL2dpdGh1Yi5jb20vbG1mcmVzbmVkYS9qcXVlcnktdG9rZW5pemVyXHJcbiAqXHJcbiAqICBNYWRlIGJ5IEx1aXMgTWlndWVsIEYuXHJcbiAqICBVbmRlciBNSVQgTGljZW5zZSAoaHR0cHM6Ly9naXRodWIuY29tL2xtZnJlc25lZGEvanF1ZXJ5LXRva2VuaXplci9ibG9iL21hc3Rlci9MSUNFTlNFKVxyXG4gKi9cclxuOyhmdW5jdGlvbiAoJCkge1xyXG4gIFwidXNlIHN0cmljdFwiO1xyXG5cclxuICAkLnRva2VuaXplciA9IHtcclxuICAgIHZlcnNpb246IFwiMC4xXCIsXHJcbiAgICBLRVlfQ09ERToge1xyXG4gICAgICBBUlJPV19ET1dOOiA0MCxcclxuICAgICAgQVJST1dfTEVGVDogMzcsXHJcbiAgICAgIEFSUk9XX1JJR0hUOiAzOSxcclxuICAgICAgQVJST1dfVE9QOiAzOCxcclxuICAgICAgQkFDS1NQQUNFOiAzMixcclxuICAgICAgQ09NTUE6IDE4OCxcclxuICAgICAgQ1RSTDogMTcsXHJcbiAgICAgIERFTDogOCxcclxuICAgICAgRE9UOiAxOTAsXHJcbiAgICAgIEVOVEVSOiAxMyxcclxuICAgICAgRVNDOiAyNyxcclxuICAgICAgU0hJRlQ6IDE2LFxyXG4gICAgICBTVVBSOiA0NixcclxuICAgICAgVEFCOiA5XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJC5mbi50b2tlbml6ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgJHRoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vUFJJVkFURSBNRVRIT0RTXHJcbiAgICB2YXIgX3VuaXF1ZUFycmF5ID0gZnVuY3Rpb24gKGFycmF5KSB7XHJcbiAgICAgIHZhciBhID0gYXJyYXkuY29uY2F0KCk7XHJcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgIGZvciAodmFyIGogPSBpICsgMTsgaiA8IGEubGVuZ3RoOyArK2opIHtcclxuICAgICAgICAgIGlmIChhW2ldID09PSBhW2pdKVxyXG4gICAgICAgICAgICBhLnNwbGljZShqLS0sIDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gYTtcclxuICAgIH1cclxuICAgIHZhciBfZ2V0V3JhcHBlclZhbHVlcyA9IGZ1bmN0aW9uICgkaW5wdXQpIHtcclxuICAgICAgdmFyICR3cmFwcGVyVmFsdWVzID0gJChcIjxkaXY+PC9kaXY+XCIpXHJcbiAgICAgIC5hZGRDbGFzcyhcInRva2VuaXplci12YWx1ZXNcIilcclxuICAgICAgLndpZHRoKCRpbnB1dC53aWR0aCgpIC0gNyk7XHJcbiAgICAgIHJldHVybiAkd3JhcHBlclZhbHVlcztcclxuICAgIH1cclxuICAgIHZhciBfcmVtb3ZlQWxsVG9rZW4gPSBmdW5jdGlvbiAoJGlucHV0KSB7XHJcbiAgICAgICQoXCIudG9rZW5pemVyLXRva2VuXCIsICRpbnB1dC5wYXJlbnQoKSkucmVtb3ZlKCk7XHJcbiAgICB9XHJcbiAgICB2YXIgX3JlbW92ZVRva2VuID0gZnVuY3Rpb24oJHRva2Vucykge1xyXG4gICAgICAkdG9rZW5zLmVhY2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICQodGhpcykucmVtb3ZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgdmFyIF9nZXRUb2tlbiA9IGZ1bmN0aW9uICh2YWx1ZSwgc2V0dGluZ3MpIHtcclxuICAgICAgdmFyICR0b2tlbiA9ICQoXCI8c3Bhbj48L3NwYW4+XCIpXHJcbiAgICAgIC5hZGRDbGFzcyhcInRva2VuaXplci10b2tlblwiKVxyXG4gICAgICAudGV4dCh2YWx1ZSlcclxuICAgICAgLmF0dHIoXCJkYXRhLXZhbHVlXCIsIHZhbHVlKVxyXG4gICAgICAucHJlcGVuZCgkKFwiPHNwYW4+PC9zcGFuPlwiKVxyXG4gICAgICAuYWRkQ2xhc3MoXCJ0b2tlbml6ZXItdG9rZW4tY2xvc2VcIilcclxuICAgICAgLnRleHQoXCJ4XCIpKTtcclxuICAgICAgJHRva2VuLm9uKFwiY2xpY2tcIiwgc2V0dGluZ3Mub25DbGlja1Rva2VuKTtcclxuICAgICAgJHRva2VuLmZpbmQoXCJzcGFuXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIF9yZW1vdmVUb2tlbigkdG9rZW4pO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuICR0b2tlbjtcclxuICAgIH1cclxuICAgIHZhciBfc2hvd01heEFsbCA9IGZ1bmN0aW9uICgkd3JhcHBlclZhbHVlcywgc2V0dGluZ3MpIHtcclxuICAgICAgdmFyICR0b2tlbiA9IF9nZXRUb2tlbigkLmZuLnRva2VuaXplci5kZWZhdWx0cy50ZXh0Lm1heF9hbGwsIHNldHRpbmdzKTtcclxuICAgICAgJHRva2VuLmFkZENsYXNzKFwidG9rZW5pemVyLXRva2VuLW1heFwiKTtcclxuICAgICAgJHRva2VuLnJlbW92ZUF0dHIoXCJkYXRhLXZhbHVlXCIpO1xyXG4gICAgICAkd3JhcHBlclZhbHVlcy5hcHBlbmQoJHRva2VuKTtcclxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICBfcmVtb3ZlVG9rZW4oJHRva2VuKTtcclxuICAgICAgfSwgMTUwMClcclxuICAgIH1cclxuICAgIHZhciBfZ2V0VmFsdWVzID0gZnVuY3Rpb24oJGlucHV0KSB7XHJcbiAgICAgIHZhciB0b2tlbnMgPSBbXTtcclxuICAgICAgJChcIi50b2tlbml6ZXItdG9rZW5bZGF0YS12YWx1ZV1cIiwgJGlucHV0LnBhcmVudCgpKS5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0b2tlbnMucHVzaCgkKHRoaXMpLmF0dHIoXCJkYXRhLXZhbHVlXCIpKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiB0b2tlbnM7XHJcbiAgICB9XHJcbiAgICB2YXIgX2J1aWxkUmVnRXhwID0gZnVuY3Rpb24oc2VwYXJhdG9ycykge1xyXG4gICAgICB2YXIgc3RyUmVnID0gXCJcXFtcIjtcclxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZXBhcmF0b3JzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgc3RyUmVnICs9IHNlcGFyYXRvcnNbaV07XHJcbiAgICAgIH1cclxuICAgICAgc3RyUmVnICs9IFwiXVwiO1xyXG4gICAgICByZXR1cm4gbmV3IFJlZ0V4cChzdHJSZWcpO1xyXG4gICAgfVxyXG4gICAgdmFyIF9wcmludFRva2VucyA9IGZ1bmN0aW9uICgkaW5wdXQsIHRva2VucywgJHdyYXBwZXJWYWx1ZXMsIHNldHRpbmdzKSB7XHJcbiAgICAgIF9yZW1vdmVBbGxUb2tlbigkaW5wdXQpO1xyXG4gICAgICAkLmVhY2godG9rZW5zLCBmdW5jdGlvbiAoaywgZWwpIHtcclxuICAgICAgICBlbCA9ICQudHJpbShlbCk7XHJcbiAgICAgICAgaWYgKGVsICE9IFwiXCIpIHtcclxuICAgICAgICAgIHZhciAkdGsgPSBfZ2V0VG9rZW4oZWwsIHNldHRpbmdzKVxyXG4gICAgICAgICAgJHdyYXBwZXJWYWx1ZXMuYXBwZW5kKCR0ayk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHZhciBfb3BlcmF0aW9ucyA9IHtcclxuICAgICAgZ2V0OiBmdW5jdGlvbiAoYXJncykge1xyXG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk7Dum1lcm8gZGUgYXJndW1lbnRvcyBpbnbDoWxpZG9zLCBzZSByZXF1aWVyZSAoJ29wdGlvbicpIHNvbGFtZW50ZVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF9nZXRWYWx1ZXMoJHRoaXMpO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6IGZ1bmN0aW9uIChhcmdzKSB7XHJcbiAgICAgICAgdmFyIHN0cjtcclxuICAgICAgICBpZiAoYXJncy5sZW5ndGggIT0gMikge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTsO6bWVybyBkZSBhcmd1bWVudG9zIGludsOhbGlkb3MsIHNlIHJlcXVpZXJlICgnb3B0aW9uJywgU3RyaW5nfEFycmF5KVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzFdID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAvL29ubHkgaW5wdXRcclxuICAgICAgICAgIHN0ciA9IGFyZ3NbMV07XHJcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzWzFdIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgIC8vYXJyYXkgaW5wdXRcclxuICAgICAgICAgIHN0ciA9IGFyZ3NbMV0uam9pbigkLmZuLnRva2VuaXplci5kZWZhdWx0cy5zZXBhcmF0b3JzWzBdKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2VndW5kbyBwYXLDoW1ldHJvIGludsOhbGlkbywgc2UgcmVxdWllcmUgKCdvcHRpb24nLCBTdHJpbmd8QXJyYXkpXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAkdGhpcy52YWwoc3RyKTtcclxuICAgICAgICAkdGhpcy50cmlnZ2VyKCQuRXZlbnQoXCJrZXlkb3duXCIsIHsga2V5Q29kZTogJC50b2tlbml6ZXIuS0VZX0NPREUuRU5URVIgfSkpO1xyXG4gICAgICAgIHJldHVybiAkdGhpcztcclxuICAgICAgfSxcclxuICAgICAgZGVsOiBmdW5jdGlvbiAoYXJncykge1xyXG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCAhPSAyKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOw7ptZXJvIGRlIGFyZ3VtZW50b3MgaW52w6FsaWRvcywgc2UgcmVxdWllcmUgKCdvcHRpb24nLCBTdHJpbmcpXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgIF9yZW1vdmVUb2tlbigkKFwiLnRva2VuaXplci10b2tlbltkYXRhLXZhbHVlPSdcIiArIGFyZ3NbMV0gKyBcIiddXCIpKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU2VndW5kbyBwYXLDoW1ldHJvIGludsOhbGlkbywgc2UgcmVxdWllcmUgKCdvcHRpb24nLCBTdHJpbmcpXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJHRoaXM7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGggfHwgJC5pc1BsYWluT2JqZWN0KGFyZ3VtZW50c1swXSkpIHtcclxuICAgICAgLy9JTklUIEJJTkRJTkdcclxuICAgICAgdmFyIHNldHRpbmdzID0gIWFyZ3VtZW50cy5sZW5ndGggPyB7fSA6IGFyZ3VtZW50c1swXTtcclxuICAgICAgJChkb2N1bWVudCkub24oXCJrZXlkb3duXCIsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PSAkLnRva2VuaXplci5LRVlfQ09ERS5TVVBSKSB7XHJcbiAgICAgICAgICBfcmVtb3ZlVG9rZW4oJChcIi50b2tlbml6ZXItdG9rZW4tYWN0aXZlXCIpKTtcclxuICAgICAgICAgIHNldHRpbmdzLm9uRGVsZXRlVG9rZW4oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgJC5mbi50b2tlbml6ZXIuZGVmYXVsdHMsIHNldHRpbmdzKTtcclxuXHJcbiAgICAgIHJldHVybiAkdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKTtcclxuICAgICAgICBjb25zb2xlLmxvZygkaW5wdXQpO1xyXG4gICAgICAgIHZhciAkd3JhcHBlciA9ICQoXCI8ZGl2PjwvZGl2PlwiKVxyXG4gICAgICAgIC5hZGRDbGFzcyhcInRva2VuaXplci13cmFwcGVyXCIpXHJcbiAgICAgICAgLndpZHRoKCRpbnB1dC53aWR0aCgpKTtcclxuICAgICAgICAkaW5wdXQud3JhcCgkd3JhcHBlcik7XHJcbiAgICAgICAgdmFyICR3cmFwcGVyVmFsdWVzID0gX2dldFdyYXBwZXJWYWx1ZXMoJGlucHV0KTtcclxuICAgICAgICAkaW5wdXQucGFyZW50KCkuYXBwZW5kKCR3cmFwcGVyVmFsdWVzKTtcclxuICAgICAgICAkaW5wdXQuY3NzKFwibWFyZ2luLWJvdHRvbVwiLCBcIjBweFwiKTtcclxuXHJcbiAgICAgICAgJGlucHV0Lm9mZigpLm9uKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgaWYgKGUua2V5Q29kZSA9PSBzZXR0aW5ncy5rZXlDb2RlQ3JlYXRlKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgaWYgKCQudHJpbSgkaW5wdXQudmFsKCkpICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICB2YXIgcmVnID0gX2J1aWxkUmVnRXhwKHNldHRpbmdzLnNlcGFyYXRvcnMpO1xyXG4gICAgICAgICAgICAgIHZhciB0b2tlbnMgPSAkaW5wdXQudmFsKCkuc3BsaXQocmVnKTtcclxuXHJcbiAgICAgICAgICAgICAgLy9jb250cm9sYW1vcyBtYXhfaW5wdXRcclxuICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MubWF4X2lucHV0ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdG9rZW5zID0gdG9rZW5zLnNwbGljZSgwLCBzZXR0aW5ncy5tYXhfaW5wdXQpO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgdmFyIHRva2VucyA9IF9nZXRWYWx1ZXMoJGlucHV0KS5jb25jYXQodG9rZW5zKTtcclxuICAgICAgICAgICAgICB2YXIgc2hvd01heCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgIC8vY29udHJvbGFtb3MgbWF4X2FsbFxyXG4gICAgICAgICAgICAgIGlmIChzZXR0aW5ncy5tYXhfYWxsID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxlbiA9IHRva2Vucy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB0b2tlbnMgPSB0b2tlbnMuc3BsaWNlKDAsIHNldHRpbmdzLm1heF9hbGwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGxlbiAhPSB0b2tlbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgIHNob3dNYXggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgaWYgKCFzZXR0aW5ncy5yZXBlYXQpIHtcclxuICAgICAgICAgICAgICAgIHRva2VucyA9IF91bmlxdWVBcnJheSh0b2tlbnMpO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgX3ByaW50VG9rZW5zKCRpbnB1dCwgdG9rZW5zLCAkd3JhcHBlclZhbHVlcywgc2V0dGluZ3MpO1xyXG5cclxuICAgICAgICAgICAgICBpZiAoc2hvd01heClcclxuICAgICAgICAgICAgICAgIF9zaG93TWF4QWxsKCR3cmFwcGVyVmFsdWVzLCBzZXR0aW5ncyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJGlucHV0LnZhbChcIlwiKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvL0FOT1RIRVIgUkVRVUVTVFxyXG4gICAgICBzd2l0Y2goYXJndW1lbnRzWzBdKSB7XHJcbiAgICAgICAgY2FzZSBcImdldFwiOlxyXG4gICAgICAgIGNhc2UgXCJ2YWxcIjpcclxuICAgICAgICAgIC8vZ2V0IHZhbHVlXHJcbiAgICAgICAgICByZXR1cm4gX29wZXJhdGlvbnMuZ2V0KGFyZ3VtZW50cyk7XHJcbiAgICAgICAgY2FzZSBcInNldFwiOlxyXG4gICAgICAgIGNhc2UgXCJpbnB1dFwiOlxyXG4gICAgICAgICAgLy9zZXQgdmFsdWVcclxuICAgICAgICAgIHJldHVybiBfb3BlcmF0aW9ucy5zZXQoYXJndW1lbnRzKTtcclxuICAgICAgICBjYXNlIFwiZGVsXCI6XHJcbiAgICAgICAgY2FzZSBcImRlbGV0ZVwiOlxyXG4gICAgICAgIGNhc2UgXCJybVwiOlxyXG4gICAgICAgIGNhc2UgXCJyZW1vdmVcIjpcclxuICAgICAgICAgIC8vcmVtb3ZlIHZhbHVlXHJcbiAgICAgICAgICByZXR1cm4gX29wZXJhdGlvbnMuZGVsKGFyZ3VtZW50cyk7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9wY2nDs24gJ1wiKyBhcmd1bWVudHNbMF0gK1wiJyBubyB2w6FsaWRhXCIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgLy9TRVRUSU5HU1xyXG4gICQuZm4udG9rZW5pemVyLmRlZmF1bHRzID0ge1xyXG4gICAgc2VwYXJhdG9yczogW1wiLFwiLCBcIjtcIl0sXHJcbiAgICBrZXlDb2RlQ3JlYXRlOiAkLnRva2VuaXplci5LRVlfQ09ERS5FTlRFUixcclxuICAgIHJlcGVhdDogZmFsc2UsXHJcbiAgICBtYXhfYWxsOiAwLFxyXG4gICAgbWF4X2lucHV0OiAwLFxyXG4gICAgdGV4dDoge1xyXG4gICAgICBtYXhfYWxsOiBcIk3DoXhpbW8gYWxjYW56YWRvXCJcclxuICAgIH0sXHJcbiAgICBvbkNsaWNrVG9rZW46IGZ1bmN0aW9uICgpIHtcclxuICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcyhcInRva2VuaXplci10b2tlbi1hY3RpdmVcIik7XHJcbiAgICB9LFxyXG4gICAgb25EZWxldGVUb2tlbjogZnVuY3Rpb24gKCkgeyB9XHJcbiAgfTtcclxuXHJcbn0pKGpRdWVyeSk7Il19
